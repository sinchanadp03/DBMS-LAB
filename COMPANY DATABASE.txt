----------------------------Company Databse------------------------------
4.Consider the schema for Company Database:
EMPLOYEE (Eid, Name, Address, Gender, Salary, SuperEid, Dno)
 DEPARTMENT (Dnum, Dname,  DMgr_id, Mgr_start_date) 
DLOCATION (Dno, Dlocation)
PROJECT (Pnum, Pname, Plocation,Dno) 
WORKS_ON (Eid, Pno, Hours)
DEPENDENT (Empid, Dep_name, Gender, Bdate, Relationship)



CREATE TABLE EMPLOYEE( 
EID INT PRIMARY KEY, 
NAME VARCHAR(20), 
ADDRESS VARCHAR(20), 
GENDER CHAR(1) CHECK(GENDER='M' OR GENDER='F'),
 SALARY INT, 
SUPEREID INT, 
FOREIGN KEY(SUPEREID) REFERENCES EMPLOYEE(EID) ON DELETE CASCADE, 
DNO INT );

INSERT INTO EMPLOYEE VALUES(1,'RAHUL','MANGALURU','M',35000,1,NULL);

INSERT INTO EMPLOYEE VALUES(2,'SAHANA','MANGALURU','F',35000,1,NULL);

INSERT INTO EMPLOYEE VALUES(3,'SAGAR','BENGALURU','M',35000,1,NULL);

INSERT INTO EMPLOYEE VALUES(4,'SAGARIK','MANGALURU','M',35000,1,NULL);

INSERT INTO EMPLOYEE VALUES(5,'SAJAAN','MYSORE','M',600000,1,NULL);


CREATE TABLE DEPARTMENT(
DNUM INT(5) PRIMARY KEY,
DNAME VARCHAR(10),
DMGR_ID INT,
FOREIGN KEY(DMGR_ID) REFERENCES EMPLOYEE(EID) ON DELETE CASCADE,
MGR_START_DATE DATE);


INSERT INTO DEPARTMENT VALUES(1,'CSE',1,'2-NOV-2007');

INSERT INTO DEPARTMENT VALUES(2,'IOT',2,'2-NOV-2007');

INSERT INTO DEPARTMENT VALUES(3,'ACCOUNT',2,'2-NOV-2017');

INSERT INTO DEPARTMENT VALUES(4,'ISE',1,'2-NOV-2000');

INSERT INTO DEPARTMENT VALUES(5,'FINANCE',1,'3-NOV-2001');


ALTER TABLE EMPLOYEE ADD CONSTRAINT FK FOREIGN KEY(DNO) REFERENCES DEPARTMENT(DNUM);

UPDATE EMPLOYEE SET DNO=4 WHERE EID=1;

UPDATE EMPLOYEE SET DNO=1 WHERE EID=2;

UPDATE EMPLOYEE SET DNO=3 WHERE EID=3;

UPDATE EMPLOYEE SET DNO=3 WHERE EID=4;

UPDATE EMPLOYEE SET DNO=3 WHERE EID=5;


CREATE TABLE DLOCATION(
DNO INT,
FOREIGN KEY(DNO) REFERENCES DEPARTMENT(DNUM) ON DELETE CASCADE,
LOCATION VARCHAR(10),
PRIMARY KEY(DNO,LOCATION));

INSERT INTO DLOCATION VALUES(1,'MANGALURU');

INSERT INTO DLOCATION VALUES(1,'MYSORE');

INSERT INTO DLOCATION VALUES(2,'MANGALURU');

INSERT INTO DLOCATION VALUES(3,'BENGALURU');

INSERT INTO DLOCATION VALUES(4,'MANGALURU');

INSERT INTO DLOCATION VALUES(5,'MANGALURU');





CREATE TABLE PROJECT(
PNUM INT(2) PRIMARY KEY,
PNAME VARCHAR(20),
PLOCATION VARCHAR(20),
DNO INT REFERENCES DEPARTMENT(DNUM));

INSERT INTO PROJECT VALUES(1,'IOT','MANGALURU',1);

INSERT INTO PROJECT VALUES(2,'DATA MINING','MANGALURU',1);

INSERT INTO PROJECT VALUES(3,'CC','HUBLI',3);

INSERT INTO PROJECT VALUES(4,'IMAGE PROCESSING','MANGALURU',4);

INSERT INTO PROJECT VALUES(5,'RESEARCH','MANGALURU',5);


CREATE TABLE WORKSON(
    EID INT(5),
    PNO INT(2),
    HOURS INT,
    PRIMARY KEY(EID, PNO),
    FOREIGN KEY(EID) REFERENCES EMPLOYEE(EID),
    FOREIGN KEY(PNO) REFERENCES PROJECT(PNUM)
);

INSERT INTO WORKSON VALUES(1, 1, 4);
INSERT INTO WORKSON VALUES(2, 1, 5);
INSERT INTO WORKSON VALUES(3, 2, 4);
INSERT INTO WORKSON VALUES(4, 3, 4);
INSERT INTO WORKSON VALUES(5, 5, 4);


CREATE TABLE DEPENDENT(
    EMPID INT PRIMARY KEY,
    DEP_NAME VARCHAR(12),
    GENDER VARCHAR(5),
    BDATE DATE,
    RELATIONSHIP VARCHAR(12), 
    FOREIGN KEY (EMPID) REFERENCES EMPLOYEE(EID) ON DELETE CASCADE
);

INSERT INTO DEPENDENT VALUES(1,'SHREYA','F','1975-01-22','WIFE');
INSERT INTO DEPENDENT VALUES(2,'AKASH','M','1977-06-15','BROTHER');
INSERT INTO DEPENDENT VALUES(3,'PRIYA','F','1980-09-10','SISTER');
INSERT INTO DEPENDENT VALUES(4,'NIKHIL','M','1979-02-02','FATHER');
INSERT INTO DEPENDENT VALUES(5,'AKSHA','F','1975-10-30','MOTHER');


QUERY 1:  Make a list of all project numbers for projects that involve an employee whose name is
“Rahul”, either as a worker or as a manager of the department that controls the project.

SELECT PNO FROM WORKSON WHERE EID IN
(SELECT EID FROM EMPLOYEE WHERE NAME='RAHUL')

UNION 

SELECT PNUM FROM PROJECT WHERE DNO IN
(SELECT DNUM FROM DEPARTMENT WHERE DMGR_ID IN
(SELECT EID FROM EMPLOYEE WHERE NAME ='RAHUL'));


QUERY 2:  Show the resulting salaries if every employee working on the “IoT” project is given a 10
percent raise.

SELECT EID,NAME, SALARY,SALARY+0.1*SALARY AS UPDATED_SALARY
FROM EMPLOYEE
WHERE EID IN 
(SELECT EID FROM WORKSON WHERE PNO IN(
SELECT PNUM FROM PROJECT WHERE PNAME='IOT'));




QUERY 3:  Find the sum of the salaries of all employees of the “Accounts” department, as well as 
 the maximum salary, the minimum salary, and the average salary in this department.

SELECT SUM(SALARY),AVG(SALARY),MAX(SALARY),MIN(SALARY)
FROM EMPLOYEE E, DEPARTMENT D
WHERE D.Dnum=E.Dno AND Dname='ACCOUNT';


QUERY 4: Retrieve the name of each employee who works on all the projects controlled
by department number 5 (use NOT EXISTS operator).

SELECT E.NAME
FROM EMPLOYEE E
WHERE NOT EXISTS (
    SELECT PNUM
    FROM PROJECT P
    WHERE P.DNO = 5
    AND NOT EXISTS (
        SELECT 1
        FROM WORKSON W
        WHERE W.EID = E.EID
        AND W.PNO = P.PNUM
    )
);




SELECT Eid ,NAME FROM EMPLOYEE E WHERE NOT EXISTS(
(SELECT PNUM FROM PROJECT WHERE Dno=5) MINUS
(SELECT Pno FROM WORKSON W WHERE W.Eid=E.Eid));




QUERY 5:  Create a view Dept_info that gives details of department name, Number of
employees and total 
 salary of each department.

CREATE VIEW DEPTINFO (NAME,COUNT_EMP,SUM_SAL)AS
SELECT D.DNAME, COUNT(*),SUM(SALARY)
FROM DEPARTMENT D INNER JOIN EMPLOYEE E
ON E.DNO = D.DNUM
GROUP BY D.DNAME;


SELECT * FROM DEPTINFO;